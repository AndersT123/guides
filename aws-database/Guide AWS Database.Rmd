---
title: "Guide AWS Database"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

This guide will show you how to set up a database instance and conncet to it from you own PC and an EC2 instance. Furthermore it will walk through how to access it using R and finally using a Shiny app. This guide will only use the AWS services that are eligeble for 12 months free tier.

System used Ubuntu 18.04.
MySQL database instance.

## Setup the database on AWS

Follow [10 min guide to setting up the database instance](https://aws.amazon.com/getting-started/hands-on/create-mysql-db/).

Stockholm not available for free-tier, but Frankfurt is. 

Sign into [VPC Console](https://aws.amazon.com/vpc/).

Choose Security Groups, create a new one and edit the Inbound Rule to allow Source from My IP. This will make you able to connect from your own machine.

### Connect to the database

#### Local PC

Ubuntu 18.04 desktop:

##### MySQL Workbench

Download and install MySQL Workbench

```{r, eval=FALSE}
sudo apt-get install mysql-workbench

# Launch mysql-workbench
mysql-workbench
```

* In the Hostname field enter the URL named Endpoint in you AWS console.
* In the Username field enter the username used in the database setup step.
* In the Port field enter the port from the database setup step, default 3306 for MySQL.
* In the Password field enter the password from the database setup step.

Create a table

```{r, eval=FALSE}
create table db_name.table_name(
  var1 VARCHAR(32),
  var2 INT(7)
)
insert into db_name.table_name 
  (var1, var2) VALUES
  ("ABC", 123);
```


##### R

```{r, eval=FALSE}
library(DBI)
con <- dbConnect(RMariaDB::MariaDB(),
                  dbname = "mydb",
                  username = "admin",
                  password = ,
                  host = "database-2.c4twiytuggt8.eu-central-1.rds.amazonaws.com",
                  port = 3306)
table1 <- dbReadTable(con, "table1")
```

###### Securing credentials

Check out [AWS Secrets Manager](https://docs.aws.amazon.com/codepipeline/latest/userguide/parameter-store-encryption.html)

##### Shiny



#### EC2 instance



# Security Groups with VPC

Goal: Access database instance from you own computer.

What to do: Need to allow a of set IP addresses and ports that can access the database. 

Virtual Private Cloud (VPC) -> Security Gruops -> Inbound Rules -> Source, My IP

The VPC acts as a firewall between your database instance and outside communication so in order to access the database instances you need to setup **inbound rules** allowing My IP to access the database. This is done via Security Groups in the AWS VPC Console.

# Terminal

```{r, eval=FALSE}
sudo apt-get install libpq-dev
sudo apt-get install unixodbc-dev
sudo apt-get install odbc-postgresql
```

# R

```{r, eval=FALSE}
install.packages("RPostgres")
install.packages("odbc")
```





